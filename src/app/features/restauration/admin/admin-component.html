<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50 p-4 md:p-6">
  <div class="max-w-[1800px] mx-auto">
    <!-- üéØ HEADER -->
    <div class="mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
        <div class="flex items-center gap-3">
          <div
            class="w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-xl"
          >
            <fa-icon [icon]="['fas', 'crown']" class="text-white text-2xl"></fa-icon>
          </div>
          <div>
            <h1 class="text-3xl md:text-4xl font-black text-gray-900">Dashboard Admin</h1>
            <p class="text-gray-600 font-medium">
              {{ dashboardData() ? formatDate(dashboardData()!.date) : 'Chargement...' }}
            </p>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <input
            type="date"
            [value]="filters().selectedDate"
            (change)="onDateChange($any($event.target).value)"
            class="px-4 py-2.5 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none font-bold shadow-lg"
          />
          <button
            (click)="loadData()"
            class="px-4 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold hover:shadow-xl transition-all flex items-center gap-2"
          >
            <fa-icon [icon]="['fas', 'sync']"></fa-icon>
            <span class="hidden md:inline">Actualiser</span>
          </button>
        </div>
      </div>

      <!-- üìä STATS GLOBALES -->
      @if (dashboardData()) {
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-blue-100">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
              <fa-icon [icon]="['fas', 'shopping-cart']" class="text-blue-600 text-xl"></fa-icon>
            </div>
            <div>
              <p class="text-xs font-bold text-gray-600">COMMANDES</p>
              <p class="text-2xl font-black text-gray-900">
                {{ dashboardData()!.globalStats.totalOrders }}
              </p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-green-100">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
              <fa-icon [icon]="['fas', 'dollar-sign']" class="text-green-600 text-xl"></fa-icon>
            </div>
            <div>
              <p class="text-xs font-bold text-gray-600">TOTAL</p>
              <p class="text-xl font-black text-green-600">
                {{ formatAmount(dashboardData()!.globalStats.totalAmount) }}
              </p>
              <p class="text-xs font-bold text-gray-500">FCFA</p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-purple-100">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
              <fa-icon [icon]="['fas', 'users']" class="text-purple-600 text-xl"></fa-icon>
            </div>
            <div>
              <p class="text-xs font-bold text-gray-600">UTILISATEURS</p>
              <p class="text-2xl font-black text-gray-900">
                {{ dashboardData()!.globalStats.totalUsers }}
              </p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-orange-100">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
              <fa-icon [icon]="['fas', 'store']" class="text-orange-600 text-xl"></fa-icon>
            </div>
            <div>
              <p class="text-xs font-bold text-gray-600">RESTAURANTS</p>
              <p class="text-2xl font-black text-gray-900">
                {{ dashboardData()!.globalStats.totalRestaurants }}
              </p>
            </div>
          </div>
        </div>
      </div>
      }
    </div>

    @if (isLoading()) {
    <div class="flex justify-center items-center py-20">
      <div class="relative w-20 h-20">
        <div
          class="absolute inset-0 rounded-full border-4 border-blue-200 animate-ping opacity-20"
        ></div>
        <div
          class="absolute inset-0 rounded-full border-4 border-blue-600 border-t-transparent animate-spin"
        ></div>
      </div>
    </div>
    } @if (!isLoading() && dashboardData()) {
    <!-- üè™ MINI CARDS RESTAURANTS -->
    <div class="mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-black text-gray-900 flex items-center gap-2">
          <fa-icon [icon]="['fas', 'store']" class="text-orange-600"></fa-icon>
          Restaurants
        </h2>
        <button
          (click)="selectRestaurant(null)"
          [class]="
            filters().selectedRestaurantId === null
              ? 'px-4 py-2 bg-blue-600 text-white rounded-xl font-bold'
              : 'px-4 py-2 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300'
          "
        >
          Tous
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        @for (restaurant of filteredRestaurants(); track restaurant.restaurantId) {
        <div
          (click)="selectRestaurant(restaurant.restaurantId)"
          [class]="
            filters().selectedRestaurantId === restaurant.restaurantId
              ? 'bg-gradient-to-br from-blue-500 to-purple-600 text-white cursor-pointer'
              : 'bg-white hover:shadow-xl cursor-pointer'
          "
          class="rounded-2xl p-5 shadow-lg transition-all border-2 border-transparent hover:border-blue-300"
        >
          <div class="flex items-start justify-between mb-3">
            <div class="flex-1">
              <h3
                [class]="
                  filters().selectedRestaurantId === restaurant.restaurantId
                    ? 'text-white'
                    : 'text-gray-900'
                "
                class="font-black text-lg truncate"
              >
                {{ restaurant.restaurantName }}
              </h3>
              <p
                [class]="
                  filters().selectedRestaurantId === restaurant.restaurantId
                    ? 'text-white/80'
                    : 'text-gray-600'
                "
                class="text-sm font-medium"
              >
                {{ restaurant.totalOrders }} commande(s)
              </p>
            </div>
            <button
              (click)="exportRestaurant(restaurant); $event.stopPropagation()"
              [class]="
                filters().selectedRestaurantId === restaurant.restaurantId
                  ? 'bg-white/20 hover:bg-white/30'
                  : 'bg-blue-100 hover:bg-blue-200'
              "
              class="w-10 h-10 rounded-xl flex items-center justify-center transition-colors"
            >
              <fa-icon
                [icon]="['fas', 'download']"
                [class]="
                  filters().selectedRestaurantId === restaurant.restaurantId
                    ? 'text-white'
                    : 'text-blue-600'
                "
              ></fa-icon>
            </button>
          </div>

          <div
            [class]="
              filters().selectedRestaurantId === restaurant.restaurantId
                ? 'bg-white/10'
                : 'bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200'
            "
            class="rounded-xl p-3"
          >
            <p
              [class]="
                filters().selectedRestaurantId === restaurant.restaurantId
                  ? 'text-white/70'
                  : 'text-gray-600'
              "
              class="text-xs font-bold mb-1"
            >
              MONTANT TOTAL
            </p>
            <p
              [class]="
                filters().selectedRestaurantId === restaurant.restaurantId
                  ? 'text-white'
                  : 'text-green-700'
              "
              class="text-2xl font-black"
            >
              {{ formatAmount(restaurant.totalAmount) }}
            </p>
            <p
              [class]="
                filters().selectedRestaurantId === restaurant.restaurantId
                  ? 'text-white/80'
                  : 'text-gray-600'
              "
              class="text-xs font-bold"
            >
              FCFA
            </p>
          </div>

          <div class="grid grid-cols-2 gap-2 mt-3">
            <div
              [class]="
                filters().selectedRestaurantId === restaurant.restaurantId
                  ? 'bg-white/10'
                  : 'bg-green-50'
              "
              class="rounded-lg p-2 text-center"
            >
              <p
                [class]="
                  filters().selectedRestaurantId === restaurant.restaurantId
                    ? 'text-white/70'
                    : 'text-gray-600'
                "
                class="text-xs font-semibold"
              >
                Confirm√©es
              </p>
              <p
                [class]="
                  filters().selectedRestaurantId === restaurant.restaurantId
                    ? 'text-white'
                    : 'text-green-600'
                "
                class="text-xl font-black"
              >
                {{ restaurant.confirmedCount }}
              </p>
            </div>
            <div
              [class]="
                filters().selectedRestaurantId === restaurant.restaurantId
                  ? 'bg-white/10'
                  : 'bg-red-50'
              "
              class="rounded-lg p-2 text-center"
            >
              <p
                [class]="
                  filters().selectedRestaurantId === restaurant.restaurantId
                    ? 'text-white/70'
                    : 'text-gray-600'
                "
                class="text-xs font-semibold"
              >
                Annul√©es
              </p>
              <p
                [class]="
                  filters().selectedRestaurantId === restaurant.restaurantId
                    ? 'text-white'
                    : 'text-red-600'
                "
                class="text-xl font-black"
              >
                {{ restaurant.cancelledCount }}
              </p>
            </div>
          </div>
        </div>
        }
      </div>
    </div>

    <!-- üîç BARRE DE RECHERCHE -->
    <div class="bg-white rounded-2xl shadow-lg p-4 mb-6">
      <div class="flex flex-col md:flex-row gap-3">
        <div class="flex-1 relative">
          <fa-icon
            [icon]="['fas', 'search']"
            class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"
          ></fa-icon>
          <input
            type="text"
            [value]="filters().searchTerm"
            (input)="onSearch($any($event.target).value)"
            placeholder="Rechercher par nom, plat ou restaurant..."
            class="w-full pl-12 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none font-medium"
          />
        </div>
        <label class="flex items-center gap-2 px-4 py-3 bg-gray-50 rounded-xl cursor-pointer">
          <input
            type="checkbox"
            [checked]="filters().showCancelled"
            (change)="updateShowCancelled($event)"
            class="w-5 h-5 text-blue-600 rounded"
          />
          <span class="font-bold text-gray-700">Afficher annul√©es</span>
        </label>
      </div>
    </div>

    <!-- üë§ LISTE DES UTILISATEURS -->
    <div>
      <h2 class="text-2xl font-black text-gray-900 mb-4 flex items-center gap-2">
        <fa-icon [icon]="['fas', 'users']" class="text-purple-600"></fa-icon>
        Commandes Utilisateurs ({{ filteredUsers().length }})
      </h2>

      <div class="space-y-4">
        @for (user of filteredUsers(); track user.userId) {
        <div
          class="bg-white rounded-2xl shadow-lg overflow-hidden border-2 border-gray-100 hover:border-blue-200 hover:shadow-xl transition-all"
        >
          <!-- Header utilisateur -->
          <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-5">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center text-white font-black text-2xl shadow-lg"
                >
                  {{ user.username.charAt(0).toUpperCase() }}
                </div>
                <div>
                  <h3 class="text-2xl font-black text-white">{{ user.username }}</h3>
                  <p class="text-white/80 text-sm font-medium">{{ user.email }}</p>
                  <div class="flex items-center gap-3 mt-1">
                    <span class="px-3 py-1 bg-white/20 rounded-lg text-xs font-bold text-white">
                      {{ user.restaurants.join(', ') }}
                    </span>
                  </div>
                </div>
              </div>

              <div class="text-right">
                <p class="text-sm text-white/80 font-bold mb-1">TOTAL √Ä PAYER</p>
                <p class="text-3xl font-black text-white">
                  {{ formatAmount(user.totalAmount) }}
                </p>
                <p class="text-sm text-white/90 font-bold">FCFA</p>
                @if (user.balance !== 0) {
                <p [class]="'text-xs font-bold mt-1 ' + getBalanceColor(user.balance)">
                  Solde: {{ formatAmount(user.balance) }} F
                </p>
                }
              </div>
            </div>
          </div>

          <!-- Corps -->
          <div class="p-5">
            <!-- Plats command√©s -->
            <div class="mb-4">
              <h4 class="text-sm font-black text-gray-700 mb-3 flex items-center gap-2">
                <fa-icon [icon]="['fas', 'utensils']" class="text-orange-500"></fa-icon>
                PLATS COMMAND√âS
              </h4>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                @for (meal of user.meals; track meal.name + meal.restaurant) {
                <div
                  class="bg-gradient-to-br from-orange-50 to-red-50 rounded-lg p-3 border border-orange-200"
                >
                  <div class="flex items-center justify-between">
                    <div class="flex-1">
                      <p class="font-bold text-gray-900 text-sm">{{ meal.name }}</p>
                      <p class="text-xs text-gray-600">{{ meal.restaurant }}</p>
                    </div>
                    <span class="text-2xl font-black text-orange-600">√ó{{ meal.quantity }}</span>
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
        </div>
        }
      </div>

      @if (filteredUsers().length === 0) {
      <div class="text-center py-12 bg-white rounded-2xl shadow-lg">
        <div class="text-6xl mb-4">üîç</div>
        <h3 class="text-2xl font-black text-gray-900 mb-2">Aucun r√©sultat</h3>
        <p class="text-gray-600">Essayez de modifier vos filtres</p>
      </div>
      }
    </div>
    }
  </div>
</div>
